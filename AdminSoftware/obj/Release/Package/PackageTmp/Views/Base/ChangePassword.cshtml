<div class="panel panel-default">
    <div class="panel-body">
        <div class="row">
            <div class="col-md-4">
                <label>Mật khẩu hiện tại (*)</label>
            </div>
            <div class="col-md-8">
                <input type="password" class="form-control" id="CurrentPassword" />
            </div>
        </div>
        <div class="row">
            <div class="col-md-4">
                <label>Mật khẩu mới (*)</label>
            </div>
            <div class="col-md-8">
                <input type="password" class="form-control" id="Password"/>
            </div>
        </div>
        <div class="row">
            <div class="col-md-4">
                <label>Xác nhận mật khẩu (*)</label>
            </div>
            <div class="col-md-8">
                <input type="password" class="form-control" id="ConfirmPassword" />
            </div>
        </div>
    </div>
</div>
<div class="panel panel-default window-footer">
    <div class="panel-body">
        <div class="row">
            <div class="col-md-12 text-right">
                <button class="btn btn-primary" id="btnUpdatePassword">
                    <i class="glyphicon glyphicon-floppy-saved"></i>
                    Đổi mật khẩu
                </button>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    $(document).ready(function() {
        $('#btnUpdatePassword').click(function() {
            var model = {
                UserId: 0,
                RoleId: 0,
                UserName: "",
                Password: $('#Password').val(),
                CurrentPassword: $('#CurrentPassword').val()
            };
            if (model.CurrentPassword == null || model.CurrentPassword.trim() === "") {
                $.msgBox({
                    title: "Hệ thống",
                    type: "error",
                    content: "Bạn phải nhập mật khẩu hiện tại!",
                    buttons: [{ value: "Đồng ý" }],
                    success: function () {
                    }
                });
                return;
            }
            if (model.Password == null || model.Password.trim() === "") {
                $.msgBox({
                    title: "Hệ thống",
                    type: "error",
                    content: "Bạn phải nhập mật khẩu mới!",
                    buttons: [{ value: "Đồng ý" }],
                    success: function () {
                    }
                });
                return;
            }
            if (model.Password.length < 6) {
                $.msgBox({
                    title: "Hệ thống",
                    type: "error",
                    content: "Mật khẩu mới phải lớn hơn 6 ký tự!",
                    buttons: [{ value: "Đồng ý" }],
                    success: function () {
                    }
                });
                return;
            }
            if ($('#ConfirmPassword').val() !== model.Password) {
                $.msgBox({
                    title: "Hệ thống",
                    type: "error",
                    content: "Mật khẩu xác nhận không chính xác!",
                    buttons: [{ value: "Đồng ý" }],
                    success: function () {
                    }
                });
                return;
            }
            $('#processing').show();
            $.ajax({
                type:'POST',
                url:'@Url.Action("SavePassword","Base")',
                data: JSON.stringify({ currentPassword: model.CurrentPassword, password:model.Password }),
                contentType: 'application/json;charset=utf-8',
                success: function (response) {
                    $('#processing').hide();
                    if (response.Status === 0) {
                        $.msgBox({
                            title: "Hệ thống",
                            type: "error",
                            content: response.Message,
                            buttons: [{ value: "Đồng ý" }],
                            success: function() {
                            }
                        });
                    } else {
                        $.msgBox({
                            title: "Hệ thống",
                            type: "info",
                            content: response.Message,
                            buttons: [{ value: "Đồng ý" }],
                            success: function () {
                                CloseWindowModal();
                            }
                        });
                    }
                }
            });
        });
    });
</script>

